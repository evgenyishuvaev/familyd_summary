# Сервис запроса и обработки погоды

## Описание проекта 

Данные проект использует Open Weather Map API для получения информации о погоде в выбранном городе и в указанное время. Для этого используется информация о городах предоставленная сервисом в формате json.

Для написания проекта были использованы следующие пакеты:
* FastAPI - асинхронный веб фрэймфорка для обработки обращений клиента
* aiohttp - для асинхронных запросов к сервису Open Weather Map API
* environs - для загрузки переменых из файла .env
* SQLAlchemy - для формирования таблиц и запросов к базам данных
* databases - обеспечивает ассинхронные запросы к базам данных
* pydantic - для валидации и парсинга JSON ответов сервера и проекта

Выше указаны ключевые пакеты, зависимости которых указаны в файле requirements.txt

## Установка


1. Создаем директорию и витртуальное окружение прокета

```
mkdir familyd
cd familyd 
python3.9 -m venv env_doc
```

2. Активируем виртуальное окружение
```
. env_doc/bin/activate
```

3. Клонируем репозиторий
```
git clone git@github.com:evgenyishuvaev/familyd_summary.git 
```

4. Устонавливаем небходимые пакеты для работы проекта, которые берем из requirements.txt

```
pip install -r requirements.txt
```
5. Переходим в директорию проекта, и задаем значение переменным, которые хранятся в файле .env.dist, перед этим неободимо переименовать это файл в .env, для того что бы проекта его обнаружил и подгрузил все переменные в проект.
```
API_URL=https://api.openweathermap.org
API_KEY=<api ключ необходимый для авторизации>

DB_DRIVER=<название базы данных которую вы используетет>(пример: postgresql)
DB_NAME=<название базы данных, к которой подключиться проект>
DB_USERNAME=<имя пользователя для авторизации при подключении к базе данных>
DB_PASSWORD=<пароль для авторизации при подключении к базе данных>
DB_ADDRESS=<адрес на котором запущена ваша база данных> (пример: localhost)
DB_PORT=<порт подключения>(пример: 5432)
```
6. Запускаем проект
```
uvicorn main:app --reload #данный подход возможен только для тестов
```
7. Проверить запуск проекта можем перейдя по адресу *127.0.0.1:8000/docs*. Должно открыться окно документации проекта.

8. Для работы сервиса необходимы две таблицы в базе данных, которые нам нужно создать при первом запуске(У Вас уже должна быть создана база данных и роль обладающая привилегиями для созданной базы данных). Для этого нам необходимо отправить GET запрос по адресу 127.0.0.1:8000/create_db.

9. Следующим шагом мы импортируем информацию о городах, такую как широта, долгота, код страны и т.д в нашу таблицу *city*. Процесс добавления может занять около 5 минут. Все добавляемые строки будут отображаться в терминале. Для инициирования импорта данных в таблицу необходимо отправить GET запрос по адресу *127.0.0.1:8000/import_json*

10. Как только наши данные будут импортированы мы можем отправлять запросы с обязательнымы query параметрами по адресу
*127.0.0.1:8000/weather*. Пример:
```
http://127.0.0.1:8000/weather?country_code=RU&city=Moscow&date=2022:02:12T12:00
```

